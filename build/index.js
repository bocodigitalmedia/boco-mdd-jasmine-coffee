// Generated by CoffeeScript 1.10.0
var configure,
  hasProp = {}.hasOwnProperty,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

configure = function($) {
  var CoffeeService, CoffeeToken, Generator, JasmineCoffee, Snippets;
  if ($ == null) {
    $ = {};
  }
  if ($.indentationString == null) {
    $.indentationString = "  ";
  }
  if ($.joinString == null) {
    $.joinString = "\n";
  }
  if ($.reduceUnique == null) {
    $.reduceUnique = function(arr, v) {
      if (arr.indexOf(v) === -1) {
        arr.push(v);
      }
      return arr;
    };
  }
  if ($.CoffeeScript == null) {
    $.CoffeeScript = require("coffee-script");
  }
  if ($.globalVariables == null) {
    $.globalVariables = require("./global-variables");
  }
  if ($.filesVariableName == null) {
    $.filesVariableName = "$files";
  }
  Snippets = (function() {
    Snippets.prototype.snippets = null;

    Snippets.prototype.indentationString = null;

    Snippets.prototype.joinString = null;

    function Snippets(props) {
      var key, val;
      if (props == null) {
        props = {};
      }
      for (key in props) {
        if (!hasProp.call(props, key)) continue;
        val = props[key];
        this[key] = val;
      }
      if (this.snippets == null) {
        this.snippets = [];
      }
      if (this.indentationString == null) {
        this.indentationString = $.indentationString;
      }
      if (this.joinString == null) {
        this.joinString = $.joinString;
      }
    }

    Snippets.prototype.indent = function(code, depth) {
      var i, indentation, results;
      indentation = (function() {
        results = [];
        for (var i = 1; 1 <= depth ? i < depth : i > depth; 1 <= depth ? i++ : i--){ results.push(i); }
        return results;
      }).apply(this).map((function(_this) {
        return function() {
          return _this.indentationString;
        };
      })(this)).join('');
      return code.replace(/^/gm, indentation);
    };

    Snippets.prototype.add = function(code, depth) {
      if (depth == null) {
        depth = 1;
      }
      return this.snippets.push(this.indent(code, depth));
    };

    Snippets.prototype["break"] = function() {
      return this.snippets.push('');
    };

    Snippets.prototype.compile = function() {
      return this.snippets.join(this.joinString) + "\n";
    };

    return Snippets;

  })();
  CoffeeToken = (function() {
    CoffeeToken.prototype.type = null;

    CoffeeToken.prototype.value = null;

    CoffeeToken.prototype.variable = null;

    CoffeeToken.prototype.firstLine = null;

    CoffeeToken.prototype.firstColumn = null;

    CoffeeToken.prototype.lastLine = null;

    CoffeeToken.prototype.lastColumn = null;

    function CoffeeToken(props) {
      var key, val;
      if (props == null) {
        props = {};
      }
      for (key in props) {
        if (!hasProp.call(props, key)) continue;
        val = props[key];
        this[key] = val;
      }
    }

    CoffeeToken.isVariable = function(token) {
      return token.type === "IDENTIFIER" && token.variable;
    };

    CoffeeToken.getValue = function(token) {
      return token.value;
    };

    CoffeeToken.convert = function(csToken) {
      var first_column, first_line, last_column, last_line, ref, type, value;
      type = csToken[0], value = csToken[1], (ref = csToken[2], first_line = ref.first_line, first_column = ref.first_column, last_line = ref.last_line, last_column = ref.last_column);
      return new CoffeeToken({
        type: type,
        value: value,
        variable: csToken.variable,
        firstLine: first_line,
        firstColumn: first_column,
        lastLine: last_line,
        lastColumn: last_column
      });
    };

    return CoffeeToken;

  })();
  CoffeeService = (function() {
    CoffeeService.prototype.globalVariables = null;

    function CoffeeService(props) {
      var key, val;
      for (key in props) {
        if (!hasProp.call(props, key)) continue;
        val = props[key];
        this[key] = val;
      }
      if (this.globalVariables == null) {
        this.globalVariables = $.globalVariables;
      }
    }

    CoffeeService.prototype.tokenize = function(code) {
      return $.CoffeeScript.tokens(code).map(CoffeeToken.convert);
    };

    CoffeeService.prototype.getVariableNames = function(code) {
      var names, tokens;
      tokens = this.tokenize(code).filter(CoffeeToken.isVariable);
      names = tokens.map(CoffeeToken.getValue);
      return names.reduce($.reduceUnique, []);
    };

    CoffeeService.prototype.isGlobalVariable = function(v) {
      return indexOf.call(this.globalVariables, v) >= 0;
    };

    return CoffeeService;

  })();
  Generator = (function() {
    Generator.prototype.coffeeService = null;

    Generator.prototype.filesVariableName = null;

    function Generator(props) {
      var key, val;
      if (props == null) {
        props = {};
      }
      for (key in props) {
        if (!hasProp.call(props, key)) continue;
        val = props[key];
        this[key] = val;
      }
      if (this.coffeeService == null) {
        this.coffeeService = new CoffeeService;
      }
      if (this.filesVariableName == null) {
        this.filesVariableName = $.filesVariableName;
      }
    }

    Generator.prototype.getContextVariableNames = function(contextNode) {
      var ancestorContexts, ancestorVars, beforeEachNodes, code, reduceAncestorVars, vars;
      beforeEachNodes = contextNode.getBeforeEachNodes();
      code = beforeEachNodes.map(function(arg) {
        var code;
        code = arg.code;
        return code;
      }).join("\n");
      vars = this.coffeeService.getVariableNames(code);
      if ((ancestorContexts = contextNode.getAncestorContexts()) != null) {
        reduceAncestorVars = (function(_this) {
          return function(vars, ancestorContext) {
            return vars.concat(_this.getContextVariableNames(ancestorContext));
          };
        })(this);
        ancestorVars = ancestorContexts.reduce(reduceAncestorVars, []);
        vars = vars.filter(function(v) {
          return ancestorVars.indexOf(v) === -1;
        });
      }
      return vars.filter((function(_this) {
        return function(v) {
          return !_this.coffeeService.isGlobalVariable(v);
        };
      })(this));
    };

    Generator.prototype.generateBeforeEach = function(snippets, contextNode) {
      var beforeEachCode, beforeEachNodes, fileNodes, mockFsObject, mockFsString;
      beforeEachNodes = contextNode.getBeforeEachNodes();
      fileNodes = contextNode.getFileNodes();
      if (!(beforeEachNodes.length || fileNodes.length)) {
        return snippets;
      }
      snippets["break"]();
      snippets.add("beforeEach ->", contextNode.depth + 1);
      if (fileNodes.length) {
        mockFsObject = fileNodes.reduce((function(memo, arg) {
          var data, path;
          path = arg.path, data = arg.data;
          memo[path] = data;
          return memo;
        }), {});
        mockFsString = JSON.stringify(mockFsObject, null, 2);
        snippets.add(this.filesVariableName + " = " + mockFsString, contextNode.depth + 2);
      }
      if (beforeEachNodes.length) {
        beforeEachCode = beforeEachNodes.map(function(arg) {
          var code;
          code = arg.code;
          return code;
        }).join("\n");
        snippets.add(beforeEachCode, contextNode.depth + 2);
      }
      return snippets;
    };

    Generator.prototype.generateAfterEach = function(snippets, contextNode) {
      var fileNodes;
      fileNodes = contextNode.getFileNodes();
      if (!fileNodes.length) {
        return snippets;
      }
      snippets["break"]();
      snippets.add("afterEach ->", contextNode.depth + 1);
      snippets.add(this.filesVariableName + " = null", contextNode.depth + 2);
      return snippets;
    };

    Generator.prototype.generateAssertion = function(snippets, assertionNode) {
      var code, depth, text;
      depth = assertionNode.depth, text = assertionNode.text, code = assertionNode.code;
      snippets["break"]();
      snippets.add("it " + (JSON.stringify(text)) + ", ->", depth);
      snippets.add(code, depth + 1);
      return snippets;
    };

    Generator.prototype.generateAssertions = function(snippets, assertionNodes) {
      if (!assertionNodes.length) {
        return snippets;
      }
      return assertionNodes.reduce(this.generateAssertion.bind(this), snippets);
    };

    Generator.prototype.generateDescribe = function(snippets, contextNode) {
      var depth, text, vars;
      depth = contextNode.depth, text = contextNode.text;
      vars = this.getContextVariableNames(contextNode);
      if (depth > 1) {
        snippets["break"]();
      }
      snippets.add("describe " + (JSON.stringify(text)) + ", ->", depth);
      if (vars.length) {
        snippets.add("[" + (vars.join(', ')) + "] = []", depth + 1);
      }
      snippets = this.generateBeforeEach(snippets, contextNode);
      snippets = this.generateAfterEach(snippets, contextNode);
      snippets = this.generateAssertions(snippets, contextNode.getAssertionNodes());
      snippets = this.generateDescribes(snippets, contextNode.getContextNodes());
      return snippets;
    };

    Generator.prototype.generateDescribes = function(snippets, contextNodes) {
      if (!contextNodes.length) {
        return snippets;
      }
      return contextNodes.reduce(this.generateDescribe.bind(this), snippets);
    };

    Generator.prototype.generate = function(parseTree) {
      var snippets;
      snippets = new Snippets();
      snippets.add(this.filesVariableName + " = null\n");
      snippets = this.generateDescribes(snippets, parseTree.getContextNodes());
      return snippets.compile();
    };

    return Generator;

  })();
  return JasmineCoffee = {
    configuration: $,
    configure: configure,
    Generator: Generator,
    CoffeeService: CoffeeService,
    CoffeeToken: CoffeeToken,
    Snippets: Snippets
  };
};

module.exports = configure();

//# sourceMappingURL=index.js.map

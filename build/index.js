// Generated by CoffeeScript 1.10.0
var configure,
  hasProp = {}.hasOwnProperty,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

configure = function($) {
  var CoffeeService, CoffeeToken, Generator, JasmineCoffee, Snippets;
  if ($ == null) {
    $ = {};
  }
  if ($.indentationString == null) {
    $.indentationString = "  ";
  }
  if ($.joinString == null) {
    $.joinString = "\n\n";
  }
  if ($.globalVariables == null) {
    $.globalVariables = ["jasmine", "window", "require"];
  }
  if ($.reduceUnique == null) {
    $.reduceUnique = function(arr, v) {
      if (arr.indexOf(v) === -1) {
        arr.push(v);
      }
      return arr;
    };
  }
  if ($.CoffeeScript == null) {
    $.CoffeeScript = require("coffee-script");
  }
  Snippets = (function() {
    Snippets.prototype.snippets = null;

    Snippets.prototype.indentationString = null;

    Snippets.prototype.joinString = null;

    function Snippets(props) {
      var key, val;
      if (props == null) {
        props = {};
      }
      for (key in props) {
        if (!hasProp.call(props, key)) continue;
        val = props[key];
        this[key] = val;
      }
      if (this.snippets == null) {
        this.snippets = [];
      }
      if (this.indentationString == null) {
        this.indentationString = $.indentationString;
      }
      if (this.joinString == null) {
        this.joinString = $.joinString;
      }
    }

    Snippets.prototype.indent = function(code, depth) {
      var i, indentation, results;
      indentation = (function() {
        results = [];
        for (var i = 1; 1 <= depth ? i < depth : i > depth; 1 <= depth ? i++ : i--){ results.push(i); }
        return results;
      }).apply(this).map((function(_this) {
        return function() {
          return _this.indentationString;
        };
      })(this)).join('');
      return code.replace(/^/gm, indentation);
    };

    Snippets.prototype.add = function(code, depth) {
      if (depth == null) {
        depth = 0;
      }
      return this.snippets.push(this.indent(code, depth));
    };

    Snippets.prototype.compile = function() {
      return this.snippets.join(this.joinString) + "\n";
    };

    return Snippets;

  })();
  CoffeeToken = (function() {
    CoffeeToken.prototype.type = null;

    CoffeeToken.prototype.value = null;

    CoffeeToken.prototype.variable = null;

    CoffeeToken.prototype.firstLine = null;

    CoffeeToken.prototype.firstColumn = null;

    CoffeeToken.prototype.lastLine = null;

    CoffeeToken.prototype.lastColumn = null;

    function CoffeeToken(props) {
      var key, val;
      if (props == null) {
        props = {};
      }
      for (key in props) {
        if (!hasProp.call(props, key)) continue;
        val = props[key];
        this[key] = val;
      }
    }

    CoffeeToken.isVariable = function(token) {
      return token.type === "IDENTIFIER" && token.variable;
    };

    CoffeeToken.getValue = function(token) {
      return token.value;
    };

    CoffeeToken.convert = function(csToken) {
      var first_column, first_line, last_column, last_line, ref, type, value;
      type = csToken[0], value = csToken[1], (ref = csToken[2], first_line = ref.first_line, first_column = ref.first_column, last_line = ref.last_line, last_column = ref.last_column);
      return new CoffeeToken({
        type: type,
        value: value,
        variable: csToken.variable,
        firstLine: first_line,
        firstColumn: first_column,
        lastLine: last_line,
        lastColumn: last_column
      });
    };

    return CoffeeToken;

  })();
  CoffeeService = (function() {
    CoffeeService.prototype.globalVariables = null;

    function CoffeeService(props) {
      var key, val;
      for (key in props) {
        if (!hasProp.call(props, key)) continue;
        val = props[key];
        this[key] = val;
      }
      if (this.globalVariables == null) {
        this.globalVariables = $.globalVariables;
      }
    }

    CoffeeService.prototype.tokenize = function(code) {
      return $.CoffeeScript.tokens(code).map(CoffeeToken.convert);
    };

    CoffeeService.prototype.getVariableNames = function(code) {
      var names, tokens;
      tokens = this.tokenize(code).filter(CoffeeToken.isVariable);
      names = tokens.map(CoffeeToken.getValue);
      return names.reduce($.reduceUnique, []);
    };

    CoffeeService.prototype.isGlobalVariable = function(v) {
      return indexOf.call(this.globalVariables, v) >= 0;
    };

    return CoffeeService;

  })();
  Generator = (function() {
    Generator.prototype.coffeeService = null;

    function Generator(props) {
      var key, val;
      if (props == null) {
        props = {};
      }
      for (key in props) {
        if (!hasProp.call(props, key)) continue;
        val = props[key];
        this[key] = val;
      }
      if (this.coffeeService == null) {
        this.coffeeService = new CoffeeService;
      }
    }

    Generator.prototype.getContextVariableNames = function(node) {
      var ancestorContexts, ancestorVars, beforeEachNodes, code, reduceAncestorVars, vars;
      beforeEachNodes = node.getBeforeEachNodes();
      code = beforeEachNodes.map(function(arg) {
        var code;
        code = arg.code;
        return code;
      }).join("\n");
      vars = this.coffeeService.getVariableNames(code);
      if ((ancestorContexts = node.getAncestorContexts()) != null) {
        reduceAncestorVars = (function(_this) {
          return function(vars, ancestorContext) {
            return vars.concat(_this.getContextVariableNames(ancestorContext));
          };
        })(this);
        ancestorVars = ancestorContexts.reduce(reduceAncestorVars, []);
        vars = vars.filter(function(v) {
          return ancestorVars.indexOf(v) === -1;
        });
      }
      return vars.filter((function(_this) {
        return function(v) {
          return !_this.coffeeService.isGlobalVariable(v);
        };
      })(this));
    };

    Generator.prototype.compileFileNodes = function(snippets, nodes) {
      var depth, mockFsObject, mockFsString;
      if (!nodes.length) {
        return snippets;
      }
      depth = nodes[0].depth;
      mockFsObject = nodes.reduce((function(memo, arg) {
        var data, path;
        path = arg.path, data = arg.data;
        memo[path] = data;
        return memo;
      }), {});
      mockFsString = JSON.stringify(mockFsObject, null, 2);
      snippets.add("beforeEach ->", depth);
      snippets.add("mockFsObject = " + mockFsString, depth + 1);
      snippets.add("require('mock-fs')(mockFsObject)", depth + 1);
      snippets.add("afterEach ->", depth);
      snippets.add("require('mock-fs').restore()", depth + 1);
      return snippets;
    };

    Generator.prototype.compileBeforeEachNodes = function(snippets, nodes) {
      var code, depth;
      if (!nodes.length) {
        return snippets;
      }
      depth = nodes[0].depth;
      code = nodes.map(function(arg) {
        var code;
        code = arg.code;
        return code;
      }).join("\n");
      snippets.add("beforeEach ->", depth);
      snippets.add(code, depth + 1);
      return snippets;
    };

    Generator.prototype.compileAssertionNode = function(snippets, node) {
      var code, depth, text;
      depth = node.depth, text = node.text, code = node.code;
      snippets.add("it " + (JSON.stringify(text)) + " ->", depth);
      snippets.add(code, depth + 1);
      return snippets;
    };

    Generator.prototype.compileAssertionNodes = function(snippets, nodes) {
      if (!nodes.length) {
        return snippets;
      }
      return nodes.reduce(this.compileAssertionNode.bind(this), snippets);
    };

    Generator.prototype.compileContextNode = function(snippets, node) {
      var vars;
      vars = this.getContextVariableNames(node);
      snippets.add("describe " + (JSON.stringify(node.text)) + " ->", node.depth);
      if (vars.length) {
        snippets.add("[" + (vars.join(', ')) + "] = []", node.depth + 1);
      }
      snippets = this.compileFileNodes(snippets, node.getFileNodes());
      snippets = this.compileBeforeEachNodes(snippets, node.getBeforeEachNodes());
      snippets = this.compileAssertionNodes(snippets, node.getAssertionNodes());
      snippets = this.compileContextNodes(snippets, node.getContextNodes());
      return snippets;
    };

    Generator.prototype.compileContextNodes = function(snippets, nodes) {
      if (!nodes.length) {
        return snippets;
      }
      return nodes.reduce(this.compileContextNode.bind(this), snippets);
    };

    Generator.prototype.generate = function(parseTree) {
      var snippets;
      snippets = this.compileContextNodes(new Snippets(), parseTree.getContextNodes());
      return snippets.compile();
    };

    return Generator;

  })();
  return JasmineCoffee = {
    configuration: $,
    configure: configure,
    Generator: Generator,
    CoffeeService: CoffeeService,
    CoffeeToken: CoffeeToken,
    Snippets: Snippets
  };
};

module.exports = configure();

//# sourceMappingURL=index.js.map
